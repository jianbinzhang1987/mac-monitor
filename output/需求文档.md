# 互联网终端上网审计系统 - Mac 客户端需求文档

## 1. 流量审计与日志上报 (Traffic Audit & Log Reporting)

此类需求关注网络流量的分析、规则匹配及数据上报，核心是 **SSL 加密通道审计**。

- **SSL 加密通道审计**
  - **描述**: 访问境外互联网，访问所有的流量，经过分析，发给服务端。
  - **实现要求**: 需采用 **代理模式**，代理全局流量，确保能接管系统代理权限（"抢人家系统代理"）。
- **上报规则与响应信息**
  - **描述**: 相应规则上报，哪一类规则需要上报，需要上报对应的响应信息。
  - **细节**: 需根据管理端下发的规则（请求响应长度、URL 匹配、域名白名单）进行过滤与上报（包括部分 URL 类型数据过滤不上报）。
- **逻辑时钟**
  - **描述**: 上网日志请求时间和响应时间使用逻辑时钟，定时从管理端请求时间进行较时，程序内部维护逻辑时钟。

## 2. 截屏策略与隐私保护 (Screenshot Strategy & Privacy)

此类需求强调截屏的 **无感性** 与 **去隐私化** 能力。

- **无感去隐私截屏**
  - **描述**: 无感的截屏操作，去隐私化功能，涉及到 OCR 识别。
  - **范围**: 支持 **全屏** 与 **应用截屏**。
  - **去隐私细节**:
    - 截屏去隐私化，支持 OCR 内容识别。
    - 根据管理端敏感词关键字组合过滤图片。
    - 支持 74 网站中登录、退出、修改密码、添加支付信息、地址信息界面。
    - 支持中英文两种模式。
- **应用级定向截图**
  - **描述**: 新增应用截图，支持根据进程名称进行特定应用截图，只截取应用的窗口。
  - **策略**:
    - 优先级: 应用截屏 > 普通截图。
    - 频率: 浏览器按照原频率（非社交 5 分钟、社交 1 分钟）；WhatsApp、Telegram 1 分钟 1 次。
    - 遮挡处理: 遮挡情况需要截取全部内容。

## 3. 异常行为与安全对抗 (Abnormal Behavior & Security)

此类需求明确了具体的监控对象，特别细化了剪切板和外部设备的检测逻辑。

- **异常行为检测**
  - **描述**: 检测异常行为（完整性检测、剪切板行为、共享网络、共享热点、网络代理）。
  - **范围**: 包括对 `xs_agent.exe`, `itxsvc.exe`, `Notepad.exe`, 共享网络/热点, `clash-verge-service.exe` 等的监控。
- **文件与进程保护**
  - **描述**:
    - 文件保护类的：修改篡改。
    - 自身文件完整性校验。
- **网络欺诈与代理检测**
  - **描述**:
    - 网络代理类的发现。
    - 具有网络设备类的发现：USB Hub、USB WLAN (无线网卡)。
- **剪切板行为审计**
  - **描述**: 知道剪切板的，**只针对浏览器的操作**，包括进程、内容。
- **本地端口安全**
  - **描述**: 终端监听本地端口，只限本机访问。
- **特定浏览器的安全退出**
  - **描述**: 火狐浏览器使用非系统代理时，如果审计日志不生效，能自动退出登录。

## 4. 服务类功能与网络集成 (Service Features & Network Integration)

此类需求涉及客户端的网络接入能力及与运营商/vCPE 设备的联动。

- **POP 点选择**
  - **描述**: 客户端 POP 点选择（POP 链公），同步从管理端获取的 POP 点信息，登录后可选择 POP 点，通过保活心跳上报给管理端。
- **vCPE 设备集成**
  - **描述**: vCPE 设备，用户网络 vCPE 集成。
- **应用退出与启动**
  - **描述**: 支持应用退出功能，可完全退出客户端所有进程，并支持双击图标启动。
- **软件生命周期管理**
  - **描述**:
    - 客户端支持升级。
    - 国密证书支持更新。
- **界面更新**
  - **描述**: 界面更新。
